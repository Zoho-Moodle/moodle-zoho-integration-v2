// ============================================================================
// ğŸ¯ Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ© Ù…Ø­Ø¯Ø«Ø© - ØªØ´ØªØºÙ„ Ù…Ø¹ Ø§Ù„Ù€ ngrok tunnel Ø§Ù„Ø¬Ø¯ÙŠØ¯
// ============================================================================

// ğŸ‘‰ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ù€ API Token Ø§Ù„ÙØ¹Ù„ÙŠ Ù…Ù† Zoho
apiToken = "1000.YOUR_TOKEN_HERE";

// ğŸ‘‰ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ù€ ngrok URL Ø§Ù„ØµØ­ÙŠØ­ (Ø´ØºØ§Ù„ Ø¹Ù„Ù‰ port 8001 Ø§Ù„Ø¢Ù†)
webhookUrl = "https://noncorrespondingly-tractile-ava.ngrok-free.dev/v1/debug/webhook/zoho";

// ============================================================================

string standalone.sendAllZohoModulesDebug()
{
    modules = list();
    modules.add("Contacts");
    modules.add("Products");
    modules.add("BTEC_Classes");
    modules.add("BTEC_Enrollments");
    modules.add("BTEC_Registrations");
    modules.add("BTEC_Payments");
    modules.add("BTEC_Units");
    modules.add("BTEC_Grades");

    // ØµÙØ­Ø§Øª Ø«Ø§Ø¨ØªØ©
    pages = list();
    pages.add(1); pages.add(2); pages.add(3); pages.add(4); pages.add(5);
    pages.add(6); pages.add(7); pages.add(8); pages.add(9); pages.add(10);
    pages.add(11); pages.add(12); pages.add(13); pages.add(14); pages.add(15);
    pages.add(16); pages.add(17); pages.add(18); pages.add(19); pages.add(20);

    summary = map();
    sentModules = list();
    errorsList = list();
    summary.put("sent_modules", sentModules);
    summary.put("errors", errorsList);

    for each moduleName in modules
    {
        try
        {
            allRecords = list();

            for each page in pages
            {
                url = "https://www.zohoapis.com/crm/v2/" + moduleName + "?page=" + page + "&per_page=200";

                // âœ… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù…Ø¹ Bearer Token
                response = invokeurl
                [
                    url     : url
                    type    : GET
                    headers : {"Authorization": "Bearer " + apiToken}
                ];

                data = response.get("data");

                if (data == null || data.isEmpty())
                {
                    break;
                }

                for each rec in data
                {
                    allRecords.add(rec);
                }
            }

            info "âœ… " + moduleName + ": " + allRecords.size() + " Ø³Ø¬Ù„Ø§Øª";

            payload = map();
            payload.put("source", "zoho_discovery");
            payload.put("module", moduleName);
            payload.put("records", allRecords);
            payload.put("records_count", allRecords.size());
            payload.put("sent_at", zoho.currenttime.toString());

            webhookResponse = invokeurl
            [
                url     : webhookUrl
                type    : POST
                headers : {"Content-Type":"application/json"}
                body    : payload
            ];

            sentItem = map();
            sentItem.put("module", moduleName);
            sentItem.put("records", allRecords.size());
            sentItem.put("status", "sent");
            sentModules.add(sentItem);

            info "ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ " + moduleName + " Ø¥Ù„Ù‰: " + webhookUrl;
        }
        catch (e)
        {
            info "âŒ Ø®Ø·Ø£ ÙÙŠ " + moduleName + ": " + e.toString();
            errItem = map();
            errItem.put("module", moduleName);
            errItem.put("error", e.toString());
            errorsList.add(errItem);
        }
    }

    info "ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©!";
    info "ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø©: " + summary.toString();

    return summary.toString();
}

// ============================================================================
// Ù…Ù„Ø§Ø­Ø¸Ø§Øª:
// 1. Ø§Ø³ØªØ¨Ø¯Ù„ apiToken Ø¨Ù€ token ØµØ­ÙŠØ­ Ù…Ù† Zoho
// 2. ngrok Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ port 8001 (Ù„ÙŠØ³ 8000)
// 3. Ø§Ù„Ù€ Webhook URL ØµØ­ÙŠØ­ Ù„Ù„Ù€ debug endpoints Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©
// 4. Ø³ØªØ¬Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ: http://localhost:8001/v1/debug/stats
// ============================================================================

