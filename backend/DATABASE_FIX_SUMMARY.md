# ๐ ุชูุฑูุฑ ุชูุตููู - ุญู ูุดููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุชุงุฑูุฎ**: 20 ููุงูุฑ 2026
**ุงููุดููุฉ**: `UndefinedColumn: column students.username does not exist`
**ุงูุญู**: โ ุชู ุงูุชุทููุฑ

---

## ๐ฏ ููุฎุต ุณุฑูุน

### โ ุงููุดููุฉ
```
ERROR: column students.username does not exist
```

### โ ุงูุณุจุจ
ุฌุฏูู `students` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- ูู ููุญุฏูุซ ููุทุงุจู ุงููููุฐุฌ ุงูุฌุฏูุฏ
- ููุชูุฏ 7 ุญููู: `username`, `display_name`, `moodle_userid`, `fingerprint`, `last_sync`, `created_at`, `updated_at`

### โ ุงูุญู
ุชุดุบูู `setup_db.py` ูุฅุถุงูุฉ ุงูุญููู ุชููุงุฆูุงู

---

## ๐ ุงููููุงุช ุงููููุชุฌุฉ ููุญู

### 1๏ธโฃ **setup_db.py** โญ (ุงูุฃูู)
```bash
python setup_db.py
```
- โ ููุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ููุดุฆ ุงูุฌุฏุงูู ุฅู ูู ุชูู ููุฌูุฏุฉ
- โ ูุถูู ุงูุญููู ุงููุงูุตุฉ
- โ ููุดุฆ ุงูู indexes ุงููุทููุจุฉ

---

### 2๏ธโฃ **QUICK_START.md**
ููุฎุต ุณุฑูุน ูุญุชูู ุนูู 3 ุฎุทูุงุช ููุท ููุจุฏุก

---

### 3๏ธโฃ **DATABASE_ERROR_FIX.md**
ุดุฑุญ ุชูุตููู ูููุดููุฉ ูุงูุญู

---

### 4๏ธโฃ **DATABASE_SETUP.md**
ุฏููู ุดุงูู ูุน ุจุฏุงุฆู ูุชุนุฏุฏุฉ

---

### 5๏ธโฃ **DATABASE_MIGRATION.sql**
ุฃูุงูุฑ SQL ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ุงููุจุงุดุฑ

---

### 6๏ธโฃ **migrate_db.py**
script ุจุฏูู ูููุญุต ููุท

---

## ๐ ุงูุฎุทูุงุช ุงูุนูููุฉ

### ุงูุทุฑููุฉ 1: ุงูุฃุฏุงุฉ ุงูุชููุงุฆูุฉ (ุงูุฃุณูู โญ)

```bash
cd backend
python setup_db.py
```

**ุงููุชูุฌุฉ:**
```
โ ูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
โ ุชู ุฅูุดุงุก ุงูุฌุฏุงูู ุจูุฌุงุญ
โ ุฌููุน ุงูุญููู ููุฌูุฏุฉ!
โ ุงูุชูู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

---

### ุงูุทุฑููุฉ 2: ูุฏูููุง ุจุงุณุชุฎุฏุงู psql

```bash
psql -U admin -d moodle_zoho -f DATABASE_MIGRATION.sql
```

---

### ุงูุทุฑููุฉ 3: ูุฏูููุง ูุจุงุดุฑุฉ

```bash
psql -U admin -d moodle_zoho
```

```sql
ALTER TABLE students ADD COLUMN IF NOT EXISTS username VARCHAR UNIQUE;
ALTER TABLE students ADD COLUMN IF NOT EXISTS display_name VARCHAR;
-- ... ุฅูุฎ
```

---

## ๐ ุงูุญููู ุงููุถุงูุฉ

| ุงูุญูู | ุงูููุน | ุงูููุงุญุธุงุช |
|------|-------|---------|
| `username` | VARCHAR UNIQUE | ุงุณู ุงููุณุชุฎุฏู (ูู email) |
| `display_name` | VARCHAR | ุงูุงุณู ุงููุงูู |
| `moodle_userid` | INTEGER | ูุนุฑู ููุฏู |
| `fingerprint` | VARCHAR | SHA256 ููู change detection |
| `last_sync` | INTEGER | Unix timestamp |
| `created_at` | TIMESTAMP | ููุช ุงูุฅูุดุงุก |
| `updated_at` | TIMESTAMP | ููุช ุขุฎุฑ ุชุญุฏูุซ |

---

## โ ุฎุทูุงุช ุงูุญู ุงููุงููุฉ

### ุงูุฎุทูุฉ 1: ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
cd backend
python setup_db.py
```

### ุงูุฎุทูุฉ 2: ุชุดุบูู ุงูุฎุงุฏู
```bash
python -m uvicorn app.main:app --host 127.0.0.1 --port 8001
```

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ
```bash
curl -X POST http://127.0.0.1:8001/v1/sync/students \
  -H "Content-Type: application/json" \
  -d '{
    "records": [{
      "id": "test123",
      "Name": "ุฃุญูุฏ",
      "Academic_Email": "ahmed@test.com"
    }]
  }'
```

---

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ

```json
{
  "status": "success",
  "idempotency_key": "hash...",
  "results": [
    {
      "zoho_student_id": "test123",
      "status": "NEW",
      "message": "Student created"
    }
  ]
}
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

| ุงูุฎุทุฃ | ุงูุณุจุจ | ุงูุญู |
|------|------|------|
| `connection refused` | ุงูุฎุงุฏู ูู ูุจุฏุฃ | `python -m uvicorn ...` |
| `column does not exist` | ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุชูุญุฏูุซ | `python setup_db.py` |
| `could not connect` | PostgreSQL ูุนุทูุจ | ุชุฃูุฏ ูู ูููุฉ DATABASE_URL |

---

## ๐ ุงููููุงุช ูููุฑุงุฌุนุฉ

```
backend/
โโโ setup_db.py              โญ ุฃุฏุงุฉ ุงูุฅุนุฏุงุฏ
โโโ QUICK_START.md           ๐ ููุฎุต ุณุฑูุน
โโโ DATABASE_ERROR_FIX.md    ๐ ุดุฑุญ ุงููุดููุฉ
โโโ DATABASE_SETUP.md        ๐ ุดุฑุญ ุดุงูู
โโโ DATABASE_MIGRATION.sql   ๐ ุฃูุงูุฑ SQL
โโโ migrate_db.py            ๐ง script ูุญุต
```

---

## โจ ุงูููุฎุต ุงูููุงุฆู

| ุงูุญุงูุฉ | ูุจู | ุจุนุฏ |
|--------|-----|-----|
| **ูุงุนุฏุฉ ุงูุจูุงูุงุช** | โ ูุฏููุฉ | โ ูุญุฏุซุฉ |
| **ุงูุญููู ุงููุงูุตุฉ** | 7 ุญููู | โ ูู ุงูุญููู ููุฌูุฏุฉ |
| **ุงูุฎุงุฏู** | โ ุฃุฎุทุงุก | โ ูุนูู |
| **API** | โ ูุดู | โ ูุฌุญ |

---

## ๐ ุงูุขู!

```bash
# 1. ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช
python setup_db.py

# 2. ุชุดุบูู ุงูุฎุงุฏู
python -m uvicorn app.main:app --host 127.0.0.1 --port 8001

# 3. ุงูุงุณุชูุชุงุน! ๐
```

---

**ุงููุดููุฉ ุญูููุช! API ุฌุงูุฒ ููุงุณุชุฎุฏุงู! โ**
